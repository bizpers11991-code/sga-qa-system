# Sprint 3: Task Delegation Plan
**Date:** November 16, 2025
**AI Team:** 6 workers operational
**Coordinator:** Claude Sonnet 4.5
**Security:** No sensitive data sent externally

---

## Executive Summary

**Goal:** Implement complete workflow for SGA Foreman QA Pack App

**Key Features:**
1. Job creation & assignment system
2. Foreman notifications with Copilot daily summaries
3. QA Pack submission → Teams channel + SharePoint
4. Incident reporting with Copilot-generated unique IDs
5. NCR tracking system (exclude foremen)

**Timeline Estimate:** 2-3 days (with 6-worker AI team)
- Tomorrow: Dataverse deployment on Windows laptop (2-3 hours)
- Day 2-3: Feature implementation and testing (AI team parallel work)

**Total Cost:** ~$0.20 (mostly Gemini API calls)

---

## Workflow Breakdown

### Phase 1: Job Creation & Assignment
**User Flow:**
- Scheduler/Asphalt/Profiling Engineer creates job
- Assigns job to foreman
- Foreman receives notification
- Foreman views job details in app

**Technical Components:**
1. Job creation screen (scheduler role only)
2. Foreman assignment dropdown
3. Power Automate notification flow
4. Teams notification (Adaptive Card)

### Phase 2: Copilot Daily Summary
**User Flow:**
- Foreman opens app
- Homepage shows Copilot-generated summary of day's work
- Summary includes: jobs assigned, pending QA packs, deadlines

**Technical Components:**
1. Homepage widget (Power Apps)
2. Azure Function: GenerateDailySummary
3. Dataverse query: user's jobs for today
4. OpenAI GPT-4o: Generate natural language summary

### Phase 3: QA Pack Submission Workflow
**User Flow:**
- Foreman completes QA pack form
- Submits QA pack
- Automatic: Copy sent to Teams channel
- Automatic: PDF saved to SharePoint

**Technical Components:**
1. Submit button logic (Power Apps)
2. Power Automate flow: QAPackSubmissionFlow
3. Teams webhook (post to #qa-submissions channel)
4. SharePoint library: QA Packs (organized by job/date)
5. PDF generation (Power Automate action)

### Phase 4: Incident Reporting System
**User Flow:**
- Any user clicks "Report Incident" on homepage
- Fills out incident form (description, location, photos)
- Copilot generates unique incident ID (format: INC-YYYYMMDD-XXXX)
- Incident logged to register
- Notifications sent to management

**Technical Components:**
1. IncidentReportScreen.fx.yaml (Power Apps)
2. Photo upload component (camera + library)
3. Azure Function: GenerateIncidentID
4. Dataverse table: sga_incidentregister
5. Copilot integration: Incident ID generation logic
6. Power Automate: IncidentNotificationFlow

### Phase 5: NCR Tracking System
**User Flow:**
- Engineers/Managers create NCR (Non-Conformance Report)
- Copilot generates unique NCR ID (format: NCR-YYYYMMDD-XXXX)
- NCR logged to register
- Foreman role: Read-only access (cannot create NCRs)

**Technical Components:**
1. NCRScreen.fx.yaml (hidden from foreman role)
2. Azure Function: GenerateNCRID
3. Dataverse table: sga_ncrregister
4. Security roles: Foreman (read-only), Engineer (full access)

---

## Security Guidelines for Task Delegation

### ✅ SAFE to Send to External AI (Workers #5, #6)
- Code structure and templates
- TypeScript interfaces and type definitions
- Power Apps YAML screen structure (empty controls)
- Power Automate flow JSON skeletons
- Azure Function HTTP trigger templates
- Documentation and comments
- Algorithm logic (without real data)

### ❌ NEVER Send to External AI
- Real job names, customer names, addresses
- Actual incident descriptions or photos
- Production data from Dataverse
- API keys, credentials, secrets
- Business logic with pricing/financials
- Personally Identifiable Information (PII)

### Claude Review Required
All code generated by Workers #5 and #6 must be reviewed by Claude (me) before:
- Committing to git
- Deploying to production
- Integrating with sensitive systems

---

## Task Assignments

### Worker #1: Claude Sonnet 4.5 (Me - Coordinator)
**Role:** Architecture, coordination, security review, production deployment

**Tasks:**
1. ✅ Create Sprint 3 task plan (this document)
2. Review all AI-generated code before commit
3. Deploy Dataverse tables (tomorrow on Windows laptop)
4. Final integration testing
5. Production deployment approval
6. Sprint 3 completion report

**Why:** I have access to sensitive data and can make production decisions.

---

### Worker #2: Grok-code (OpenCode Account 1)
**Role:** Primary M365 implementation coder

**Tasks:**
1. **QAPackSubmissionFlow.json** (Power Automate)
   - Trigger: Manual (from Power Apps)
   - Actions:
     - Get QA Pack data from Dataverse
     - Generate PDF (HTML to PDF action)
     - Save PDF to SharePoint (QA Packs library)
     - Post to Teams (#qa-submissions channel with Adaptive Card)
     - Update QA Pack status to "Submitted"
   - Error handling: Log to sga_errorlogs
   - **Security:** Use placeholder data, no real customer info

2. **IncidentNotificationFlow.json** (Power Automate)
   - Trigger: When incident created in sga_incidentregister
   - Actions:
     - Get incident details
     - Send email to management
     - Post to Teams (#incidents channel)
     - Update incident status
   - **Security:** Use template data only

**Deliverables:** 2 Power Automate flow JSON files

---

### Worker #3: Grok-code (OpenCode Account 2)
**Role:** Alternative coder, testing agent

**Tasks:**
1. **JobAssignmentScreen.fx.yaml** (Power Apps)
   - Screen for Scheduler/Engineer to create jobs
   - Controls:
     - Job title input
     - Job description (multi-line)
     - Location input
     - Foreman dropdown (filtered by role)
     - Date picker (start/end dates)
     - Submit button
   - Logic:
     - Create record in sga_jobs table
     - Trigger Power Automate flow: JobAssignmentNotification
   - **Security:** Use placeholder labels, no real data

2. **IncidentReportScreen.fx.yaml** (Power Apps)
   - Screen accessible from homepage
   - Controls:
     - Incident description (multi-line, 500 char limit)
     - Location input
     - Photo upload (camera + library, max 5 photos)
     - Severity dropdown (Low/Medium/High/Critical)
     - Submit button
   - Logic:
     - Call Azure Function: GenerateIncidentID
     - Create record in sga_incidentregister
     - Upload photos to SharePoint (Incidents library)
   - **Security:** Use template structure only

**Deliverables:** 2 Power Apps screen YAML files

---

### Worker #4: Gemini 2.5 Pro (Architecture & Review)
**Role:** Architecture review, security validation, research

**Tasks:**
1. **Architecture Review: Incident ID Generation**
   - Review proposed algorithm for uniqueness
   - Ensure thread-safety (concurrent incident reports)
   - Recommend collision prevention strategy
   - Document edge cases

2. **Security Audit: SharePoint Integration**
   - Review permissions (who can read/write QA Packs)
   - Ensure foremen can only access their own jobs
   - Validate file upload restrictions (size, type)
   - Check for injection vulnerabilities

3. **Performance Analysis: Daily Summary Generation**
   - Estimate Azure Function execution time
   - Calculate OpenAI API token usage per summary
   - Recommend caching strategy
   - Identify optimization opportunities

**Deliverables:** 3 review documents (architecture, security, performance)

---

### Worker #5: Qwen 2.5 Coder 32B (Code Generation Specialist)
**Role:** Boilerplate code, TypeScript interfaces, templates

**Tasks:**
1. **TypeScript Interfaces for Sprint 3**
   ```typescript
   // src/m365-deployment/azure-functions/types/sprint3.ts

   export interface Job {
     id: string;
     title: string;
     description: string;
     location: string;
     assignedForemanId: string;
     engineerId: string;
     startDate: Date;
     endDate: Date;
     status: 'pending' | 'in-progress' | 'completed';
   }

   export interface DailySummaryRequest {
     userId: string;
     date: Date;
   }

   export interface DailySummaryResponse {
     summary: string;
     jobsToday: Job[];
     pendingQAPacks: number;
     deadlines: Date[];
   }

   export interface IncidentReport {
     id: string;
     incidentId: string; // Generated by Copilot
     description: string;
     location: string;
     severity: 'Low' | 'Medium' | 'High' | 'Critical';
     reportedBy: string;
     reportedAt: Date;
     photos: string[]; // SharePoint URLs
     status: 'open' | 'investigating' | 'resolved';
   }

   export interface NCR {
     id: string;
     ncrId: string; // Generated by Copilot
     description: string;
     jobId: string;
     createdBy: string;
     createdAt: Date;
     status: 'open' | 'closed';
   }
   ```

2. **Azure Function: GenerateDailySummary.ts**
   ```typescript
   // Template structure with placeholder logic
   // NO real OpenAI calls (security)
   // Claude will add OpenAI integration after review

   import { AzureFunction, Context, HttpRequest } from "@azure/functions";

   const GenerateDailySummary: AzureFunction = async function (
     context: Context,
     req: HttpRequest
   ): Promise<void> {
     // TODO: Authentication (EasyAuth headers)
     // TODO: Get user ID from request
     // TODO: Query Dataverse for user's jobs today
     // TODO: Query pending QA packs
     // TODO: Call OpenAI API (Claude will add this)
     // TODO: Return summary
   };

   export default GenerateDailySummary;
   ```

3. **Azure Function: GenerateIncidentID.ts**
   ```typescript
   // Algorithm for unique incident ID generation
   // Format: INC-YYYYMMDD-XXXX (XXXX = sequential counter)
   // Thread-safe implementation
   // NO Dataverse calls (Claude will add after review)
   ```

**Deliverables:** 3 TypeScript files (interfaces, 2 Azure Functions)

**Security:** All code uses placeholders. NO real API calls, NO real data.

---

### Worker #6: DeepSeek V3.1 (Advanced Reasoning & Code Review)
**Role:** Algorithm design, code review, complex logic

**Tasks:**
1. **Incident ID Generation Algorithm**
   - Design thread-safe ID generation logic
   - Format: INC-YYYYMMDD-XXXX
   - Handle concurrent requests (multiple users reporting simultaneously)
   - Prevent ID collisions
   - Fallback strategy if Dataverse query fails
   - Pseudocode (no real implementation):
   ```
   FUNCTION GenerateIncidentID():
     1. Get current date (YYYYMMDD format)
     2. Query Dataverse for max incident number today
     3. Increment counter (with mutex/lock)
     4. Format: INC-{date}-{counter:04d}
     5. Return unique ID
   ```

2. **NCR ID Generation Algorithm**
   - Similar to incident ID
   - Format: NCR-YYYYMMDD-XXXX
   - Different counter (separate from incidents)

3. **Daily Summary Logic Design**
   - Input: User ID, current date
   - Steps:
     1. Get user's jobs for today
     2. Count pending QA packs
     3. Identify approaching deadlines (within 48 hours)
     4. Format prompt for OpenAI:
        - "You are a helpful assistant for a foreman. Summarize today's work:"
        - List jobs, pending tasks, deadlines
        - Keep summary under 200 words
        - Use friendly, professional tone
   - Output: Natural language summary

4. **Code Review: Worker #5 Outputs**
   - Review TypeScript interfaces for correctness
   - Check for security vulnerabilities
   - Validate error handling
   - Suggest improvements

**Deliverables:** 4 design documents (2 algorithms, 1 logic design, 1 code review)

**Security:** All work is algorithmic design. NO real data, NO API calls.

---

## Parallel Execution Strategy

**All workers can work simultaneously:**

| Day | Worker #1 (Claude) | Worker #2 (Grok-1) | Worker #3 (Grok-2) | Worker #4 (Gemini) | Worker #5 (Qwen) | Worker #6 (DeepSeek) |
|-----|--------------------|--------------------|--------------------|--------------------|------------------|----------------------|
| **Today** | Task planning | QA submission flow | Job assignment screen | Architecture review | TypeScript interfaces | Incident ID algorithm |
| **Tomorrow** | Dataverse deployment (Windows laptop) | Incident notification flow | Incident report screen | Security audit | Azure Functions (templates) | NCR ID algorithm |
| **Day 3** | Integration testing | Bug fixes | Bug fixes | Performance analysis | Code cleanup | Daily summary logic |
| **Day 4** | Production deployment | - | - | Final review | - | Code review |

**Total Estimated Time:**
- AI team work: 2-3 days (parallel execution)
- Dataverse deployment: 2-3 hours (tomorrow on Windows laptop)
- Testing & integration: 1 day
- **Total: 3-4 days to complete app**

---

## Device Strategy

### MacBook Air (Personal Device)
**Use for:**
- ✅ AI team coordination (this conversation with Claude)
- ✅ Code review and planning
- ✅ Python scripts (test_apis.py, run_team_multi.py)
- ✅ Git commits and version control
- ✅ Documentation writing

**Limitations:**
- ❌ PowerShell scripts (Mac doesn't have PowerShell Core configured)
- ❌ Dataverse deployment (needs Windows environment)
- ❌ Power Platform CLI (better on Windows)

### Windows Laptop (Work Device)
**Use for (Tomorrow):**
- ✅ Dataverse table deployment (PowerShell script)
- ✅ Power Platform CLI configuration
- ✅ SharePoint library setup
- ✅ Teams channel configuration
- ✅ Power Automate flow deployment
- ✅ Power Apps publishing to production

**Recommendation:**
Tomorrow, switch to Windows laptop for:
1. Dataverse deployment (2-3 hours)
2. SharePoint integration setup
3. Power Automate flow import
4. Final production deployment

**Today (MacBook):** Continue AI team coordination and code generation.

---

## Copilot Integration Strategy

**Current Status:**
- ✅ Custom AI chat built (replaces Copilot Studio, saves $200/month)
- ✅ Azure Function: AIChat.ts (uses Azure OpenAI GPT-4o)
- ✅ CopilotScreen.fx.yaml (Power Apps interface)
- ✅ Security audit: PASS for production

**Copilot Features to Implement:**

1. **Daily Summary (NEW - Sprint 3)**
   - Azure Function: GenerateDailySummary.ts
   - Uses same Azure OpenAI endpoint as custom AI chat
   - Displayed on homepage widget
   - **No Copilot Studio license required**

2. **Incident ID Generation (NEW - Sprint 3)**
   - Azure Function: GenerateIncidentID.ts
   - Uses algorithm (not OpenAI) for deterministic IDs
   - Copilot provides context-aware suggestions

3. **NCR ID Generation (NEW - Sprint 3)**
   - Azure Function: GenerateNCRID.ts
   - Similar to incident ID

**Recommendation:**
- Keep custom AI chat (CopilotScreen) as primary Copilot interface
- Add new Azure Functions for daily summary and ID generation
- **NO need to revisit Copilot Studio** (saves $200/month)
- All "Copilot" features use Azure OpenAI directly

**Cost:**
- Azure OpenAI usage: ~$0.50-1.00/day for all Copilot features
- vs Copilot Studio: $200/month = $6.67/day
- **Savings: 85-90%**

---

## Timeline & Milestones

### Day 1 (Today - November 16, 2025)
**Progress:**
- ✅ 6-worker AI team operational
- ✅ Sprint 3 task plan created
- ⏳ AI workers generating code (parallel)

**AI Team Tasks (Today):**
- Worker #5: TypeScript interfaces (~2 hours)
- Worker #6: Algorithm designs (~2 hours)
- Worker #2: QA submission flow (~3 hours)
- Worker #3: Job assignment screen (~3 hours)
- Worker #4: Architecture review (~2 hours)

**Expected by End of Day:**
- All code templates generated
- Architecture reviewed
- Ready for integration testing

---

### Day 2 (Tomorrow - November 17, 2025)
**Your Work (Windows Laptop - 2-3 hours):**
1. Deploy Dataverse tables (PowerShell script)
2. Verify security roles
3. Test Dataverse connections
4. Set up SharePoint libraries (QA Packs, Incidents)
5. Configure Teams channels (#qa-submissions, #incidents)

**AI Team Tasks (Tomorrow):**
- Worker #5: Azure Function implementations
- Worker #6: Daily summary logic design
- Worker #2: Incident notification flow
- Worker #3: Incident report screen
- Worker #4: Security audit
- Worker #1 (Claude): Review all generated code, commit to git

**Expected by End of Day:**
- Dataverse fully deployed
- All Azure Functions ready (templates)
- All Power Apps screens ready
- All Power Automate flows ready

---

### Day 3 (November 18, 2025)
**Integration & Testing:**
1. Import Power Automate flows
2. Deploy Azure Functions to Azure
3. Publish Power Apps screens
4. End-to-end testing:
   - Create job → assign to foreman → notification received
   - Submit QA pack → Teams + SharePoint
   - Report incident → ID generated → register updated
5. Bug fixes (AI team assists)

**AI Team Tasks:**
- Workers #2-3: Bug fixes as needed
- Worker #4: Performance analysis
- Worker #6: Code review final outputs
- Worker #1 (Claude): Integration coordination

**Expected by End of Day:**
- All features working end-to-end
- No critical bugs
- Performance acceptable

---

### Day 4 (November 19, 2025) - Optional
**Polish & Documentation:**
1. User acceptance testing
2. Documentation updates
3. Sprint 3 completion report
4. Prepare for production launch

**If everything goes well, app could be production-ready by November 19-20, 2025.**

---

## Success Metrics

**Code Quality:**
- ✅ All code reviewed by Claude before deployment
- ✅ No security vulnerabilities (verified by Worker #4)
- ✅ TypeScript compilation errors: 0
- ✅ Linting warnings: 0

**Performance:**
- ✅ Daily summary generation: <3 seconds
- ✅ Incident ID generation: <1 second
- ✅ QA pack submission: <5 seconds (including Teams + SharePoint)

**Cost:**
- ✅ AI team work: <$0.50 total (mostly free models)
- ✅ Azure OpenAI usage: <$1/day in production
- ✅ Total project cost: <$200 (vs thousands for custom development)

**Timeline:**
- ✅ Sprint 3 completion: 3-4 days (vs 2-3 weeks manual development)
- ✅ Production-ready: November 19-20, 2025

---

## Risk Mitigation

### Risk 1: Dataverse Deployment Issues
**Mitigation:** Use PowerShell script on Windows laptop (tested in Sprint 1)
**Backup:** Manual deployment via Power Platform admin center

### Risk 2: AI-Generated Code Quality
**Mitigation:** All code reviewed by Claude before deployment
**Backup:** Claude rewrites problematic sections

### Risk 3: SharePoint Integration Complexity
**Mitigation:** Worker #4 (Gemini) reviews SharePoint permissions first
**Backup:** Use simpler file attachment approach (Power Apps native)

### Risk 4: Timeline Delays
**Mitigation:** 6 workers working in parallel (reduce bottlenecks)
**Backup:** Prioritize core features (job assignment, QA submission) first

---

## Post-Sprint 3 Ideas

User mentioned: "i have a few other ideas in my mind after this"

**Potential Future Enhancements:**
1. Mobile app optimization (offline support)
2. Advanced analytics dashboard (Power BI integration)
3. Automated job scheduling (AI-powered)
4. Equipment tracking module
5. Safety compliance module
6. Integration with accounting systems

**After Sprint 3 completion, we can discuss next priorities.**

---

## Summary

**Sprint 3 Goal:** Complete SGA Foreman QA Pack App with full workflow

**AI Team Status:** 6 workers operational, ready to execute tasks

**Timeline:** 3-4 days to production-ready app

**Next Steps:**
1. AI team starts parallel work (today)
2. Dataverse deployment (tomorrow on Windows laptop)
3. Integration testing (day 3)
4. Production launch (day 4)

**Your Role:**
- Today: Monitor AI team progress on MacBook
- Tomorrow: Dataverse deployment on Windows laptop (2-3 hours)
- Ongoing: Final review and approval

**Cost:** ~$1 total (90% using free AI models)

---

**Questions or changes to this plan? Let me know!**

**Otherwise, I'll start delegating tasks to the AI team now.**
